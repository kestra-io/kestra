<template>
    <div class="line" v-if="filtered">
        <span :class="levelClass" class="badge">{{log.level.padEnd(9)}}</span>
        <span class="badge bg-light text-dark">{{log.timestamp}}</span>
        <span class="message">{{log.message}}</span>
    </div>
</template>
<script>
export default {
    props: {
        log: {
            type: Object,
            required: true
        },
        filter: {
            type: String,
            default: ""
        },
        level: {
            type: String,
            default: "ALL"
        }
    },
    computed: {
        levelClass() {
            return {
                TRACE: "badge-info",
                DEBUG: "badge-secondary",
                INFO: "badge-primary",
                WARN: "badge-warning",
                ERROR: "badge-danger",
                CRITICAL: "badge-danger font-weight-bold",
        TRACE: "badge-dark"
            }[this.log.level];
        },
        levels() {
            return {
                all: new Set([
                    "all",
                    "critical",
                    "error",
                    "warning",
                    "info",
                    "debug",
                    "trace"
                ]),
                critical: new Set(["all", "critical"]),
                error: new Set(["all", "critical", "error"]),
                warning: new Set(["all", "critical", "error", "warning"]),
                info: new Set(["all", "critical", "error", "warning", "info"]),
                debug: new Set([
                    "all",
                    "critical",
                    "error",
                    "warning",
                    "info",
                    "debug"
                ]),
                trace: new Set([
                    "all",
                    "critical",
                    "error",
                    "warning",
                    "info",
                    "debug",
                    "trace"
                ])
            };
        },
        filtered() {
            const level = this.level.toLowerCase();
            const hasFilter =
                this.log.message &&
                this.log.message.toLowerCase().includes(this.filter);
            return (
                this.levels[level].has(this.log.level.toLowerCase()) &&
                hasFilter
            );
        }
    }
};
</script>
<style scoped lang="scss">
@import "../../styles/_variable.scss";

div {
    white-space: pre-wrap;
    word-break: break-all;

    .badge {
        font-size: 100%;
        white-space: pre-wrap;
        font-weight: $font-weight-base;
    }

    .message {
        padding: 0 $badge-padding-x;
    }
}
</style>
