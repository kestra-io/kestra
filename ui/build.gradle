plugins {
    id 'org.siouan.frontend-jdk11'
}

publishSonatypePublicationPublicationToSonatypeRepository.enabled = false

frontend {
    nodeVersion = '18.18.0'
    // due to vue-chart-3: https://github.com/victorgarciaesgi/vue-chart-3/pull/138
    installScript = 'install --legacy-peer-deps'
    assembleScript = 'run build'
    checkScript = 'run test:unit'
    maxDownloadAttempts = 5
}

tasks.named('installFrontend') {
    inputs.files('package.json', 'package-lock.json')
    outputs.dir('node_modules')
}

tasks.named('assembleFrontend') {
    shouldRunAfter installFrontend

    copy {
        from 'node_modules/vscode-web/dist/out'
        into 'public/vscode-web/dist/out'
    }
    copy {
        from 'node_modules/vscode-web/dist/node_modules'
        into 'public/vscode-web/dist/node_modules'
    }
    copy {
        from 'node_modules/vscode-web/dist/extensions'
        into 'public/vscode-web/dist/extensions'
    }

    inputs.dir('src')
    inputs.dir('public')
    inputs.files('vite.config.js')
    outputs.dir('../webserver/src/main/resources/ui')
}
