kestra:
  repository:
    type: memory
  queue:
    type: kafka
  storage:
    type: local
    local:
      base-path: /tmp/unittest

  prefix: "${random.shortuuid}"

  kafka:
    client:
      properties:
        bootstrap.servers: "localhost:9092"

    defaults:

      consumer-prefix: "unit_${kestra.prefix}"
      topic:
        partitions: 8
        properties:
          compression.type: "lz4"

      consumer:
        properties:
          isolation.level: "read_committed"
          auto.offset.reset: "earliest"
          enable.auto.commit: "false"

      producer:
        properties:
          acks: "all"
          compression.type: "lz4"
          max.request.size: "10485760"

      stream:
        properties:
          processing.guarantee: "exactly_once"
          acks: "all"
          state.dir: "/tmp/kafka-stream-unit/${kestra.prefix}"
          compression.type: "lz4"
          max.request.size: "10485760"

    topics:
      execution:
        name: "unit_${kestra.prefix}_kestra_execution"
        cls: org.kestra.core.models.executions.Execution
        properties:
          cleanup.policy: "compact"
          retention.ms: "-1"

      flow:
        name: "unit_${kestra.prefix}_kestra_flow"
        cls: org.kestra.core.models.flows.Flow
        properties:
          cleanup.policy: "compact"
          retention.ms: "-1"
          segment.bytes: "10485760"

      flowlast:
        name: "unit_${kestra.prefix}_kestra_flow_last"
        properties:
          cleanup.policy: "compact"
          retention.ms: "-1"
          segment.bytes: "10485760"

      template:
        name: "unit_${kestra.prefix}_kestra_template"
        cls: org.kestra.core.models.templates.Template
        properties:
          cleanup.policy: "compact"
          retention.ms: "-1"
          segment.bytes: "10485760"

      executor:
        name: "unit_${kestra.prefix}_kestra_executor"
        properties:
          cleanup.policy: "delete,compact"

      killed:
        name: "unit_${kestra.prefix}_kestra_executor_killed"
        cls: org.kestra.core.models.executions.ExecutionKilled
        properties:
          cleanup.policy: "delete,compact"

      executorflowtrigger:
        name: "unit_${kestra.prefix}_kestra_executor_flowtrigger"
        cls: org.kestra.runner.kafka.streams.ExecutorFlowTrigger
        properties:
          cleanup.policy: "delete,compact"

      workertask:
        name: "unit_${kestra.prefix}_kestra_workertask"
        cls: org.kestra.core.runners.WorkerTask
        properties:
          cleanup.policy: "delete,compact"

      workertaskresult:
        name: "unit_${kestra.prefix}_kestra_workertaskresult"
        cls: org.kestra.core.runners.WorkerTaskResult
        properties:
          cleanup.policy: "delete,compact"

      workerinstance:
        cls: org.kestra.core.runners.WorkerInstance
        name: "unit_${kestra.prefix}_kestra_workerinstance"
        properties:
          cleanup.policy: "compact"

      executorworkerinstance:
        name: "unit_${kestra.prefix}_kestra_executor_workerinstance"
        properties:
          cleanup.policy: "compact"

      workertaskrunning:
        cls: org.kestra.core.runners.WorkerTaskRunning
        name: "unit_${kestra.prefix}_kestra_workertaskrunning"
        properties:
          cleanup.policy: "delete,compact"

      logentry:
        cls: org.kestra.core.models.executions.LogEntry
        name: "unit_${kestra.prefix}_kestra_logs"

      trigger:
        cls: org.kestra.core.models.triggers.Trigger
        name: "unit_${kestra.prefix}_kestra_trigger"
        properties:
          cleanup.policy: "compact"
