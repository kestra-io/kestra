micronaut:
  application:
    name: kestra
  router:
    static-resources:
      swagger:
        paths: classpath:META-INF/swagger
        mapping: /swagger/**
      ui:
        paths: classpath:ui
        mapping: /ui/**
  server:
    max-request-size: 10GB
    multipart:
      max-file-size: 10GB
      disk: true
    read-idle-timeout: 60m
    write-idle-timeout: 60m
    idle-timeout: 60m
    netty:
      max-chunk-size: 10MB

jackson:
  serialization:
    writeDatesAsTimestamps: false

endpoints:
  all:
    port: 8081
    enabled: true
    sensitive: false
  health:
    details-visible: ANONYMOUS

kestra:
  kafka:
    defaults:
      topic:
        partitions: 16
        replication-factor: 1

      consumer:
        properties:
          isolation.level: "read_committed"
          auto.offset.reset: "earliest"
          enable.auto.commit: "false"
          max.poll.interval.ms: 3600000 # max duration of tasks

      producer:
        properties:
          acks: "all"
          compression.type: "lz4"
          max.request.size: "10485760"

      stream:
        properties:
          processing.guarantee: "exactly_once"
          replication.factor: "${kestra.kafka.defaults.topic.replication-factor}"
          acks: "all"
          compression.type: "lz4"
          max.request.size: "10485760"

    topics:
      execution:
        name: "kestra_execution"
        cls: org.kestra.core.models.executions.Execution
        properties:
          cleanup.policy: "compact"
          retention.ms: "-1"

      flow:
        name: "kestra_flow"
        cls: org.kestra.core.models.flows.Flow
        properties:
          cleanup.policy: "compact"
          retention.ms: "-1"
          segment.bytes: "10485760"

      executor:
        name: "kestra_executor"
        properties:
          cleanup.policy: "delete,compact"

      killed:
        name: "kestra_executor_killed"
        cls: org.kestra.core.models.executions.ExecutionKilled
        properties:
          cleanup.policy: "delete,compact"

      workertask:
        name: "kestra_workertask"
        cls: org.kestra.core.runners.WorkerTask
        partitions: 64
        properties:
          cleanup.policy: "delete,compact"

      workertaskresult:
        name: "kestra_workertaskresult"
        cls: org.kestra.core.runners.WorkerTaskResult
        properties:
          cleanup.policy: "delete,compact"

      logentry:
        cls: org.kestra.core.models.executions.LogEntry
        name: "kestra_logs"

  elasticsearch:
    indices:
      flows:
        index: "kestra_flows"
        cls: org.kestra.core.models.flows.Flow
        mapping-file: flow
      flows-revisions:
        index: "kestra_flows_revisions"
        cls: org.kestra.core.models.flows.Flow
        mapping-file: flow
      executions:
        index: "kestra_executions"
        cls: org.kestra.core.models.executions.Execution
        mapping-file: execution
      triggers:
        index: "kestra_triggers"
        cls: org.kestra.core.models.triggers.Trigger
        mapping-file: trigger
      logs:
        index: "kestra_logs"
        cls: org.kestra.core.models.executions.LogEntry
        mapping-file: log

  plugins:
    repositories:
      central:
        url: https://repo.maven.apache.org/maven2/
      jcenter:
        url: https://jcenter.bintray.com/
      kestra:
        url: https://dl.bintray.com/kestra/maven

  variables:
    env-vars-prefix: KESTRA_
    globals: {}

  metrics:
    prefix: kestra

  server:
    access-log:
      enabled: true
      name: org.kestra.webserver.access
      format: "[Date: {}] [Duration: {} ms] [Method: {}] [Url: {}] [Status: {}] [Length: {}] [Ip: {}] [Port: {}]"
      filters:
        - ".*\\[Url: /api/.*"
