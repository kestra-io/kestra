id: each-object
namespace: org.kestra.tests

tasks:
  - id: 1_each
    type: org.kestra.core.tasks.flows.EachSequential
    value: |
      [
        "value 1",
        {"key": "my-key", "value": "my-value"},
        {"key": "my-complex", "value": {"sub": 1, "bool": true}}
      ]

    tasks:
      - id: is-json
        type: org.kestra.core.tasks.flows.Switch
        value: "{{isJson taskrun.value}}"
        cases:
          "false":
            - id: not-json
              type: org.kestra.core.tasks.debugs.Return
              format: "{{task.id}} > STRING > {{parent.taskrun.value}}"
        defaults:
        - id: json
          type: org.kestra.core.tasks.debugs.Return
          format: "{{task.id}} > JSON > {{jq parent.taskrun.value '.key'}} > {{jq parent.taskrun.value '.value'}}"

  - id: 2_end
    type: org.kestra.core.tasks.debugs.Return
    format: "{{task.id}} > {{taskrun.startDate}}"
